{% extends 'base.html' %}

{% block title %}Registrar Visita - Sistema de Asistencias{% endblock %}

{% block content %}
<div class="max-w-2xl mx-auto">
    <div class="bg-white rounded-lg shadow-md p-6">
        <div class="text-center mb-6">
            <i class="fas fa-id-card text-5xl text-blue-600 mb-4"></i>
            <h1 class="text-2xl font-bold text-gray-800">Registro de Visita</h1>
            <p class="text-gray-600">Complete el formulario para programar su visita</p>
        </div>

        <form method="POST" enctype="multipart/form-data">
            {% csrf_token %}

            <!-- Datos del visitante -->
            <div class="border-b border-gray-200 pb-6 mb-6">
                <h2 class="text-lg font-semibold text-gray-700 mb-4">
                    <i class="fas fa-user mr-2"></i>Datos del Visitante
                </h2>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="md:col-span-2">
                        <label class="block text-gray-700 text-sm font-bold mb-2">
                            Nombre Completo <span class="text-red-500">*</span>
                        </label>
                        <input type="text" name="nombre_visitante" required
                            class="shadow border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500"
                            placeholder="Nombre y apellidos">
                    </div>

                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2">Empresa</label>
                        <input type="text" name="empresa"
                            class="shadow border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500"
                            placeholder="Nombre de la empresa">
                    </div>

                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2">Telefono</label>
                        <input type="tel" name="telefono"
                            class="shadow border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500"
                            placeholder="10 digitos">
                    </div>

                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2">Email</label>
                        <input type="email" name="email"
                            class="shadow border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500"
                            placeholder="correo@ejemplo.com">
                    </div>

                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2">Tipo de Identificacion</label>
                        <select name="identificacion_tipo"
                            class="shadow border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="ine">INE/IFE</option>
                            <option value="pasaporte">Pasaporte</option>
                            <option value="licencia">Licencia de Conducir</option>
                            <option value="otro">Otro</option>
                        </select>
                    </div>

                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2">Numero de Identificacion</label>
                        <input type="text" name="identificacion_numero"
                            class="shadow border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>

                    <div class="md:col-span-2">
                        <label class="block text-gray-700 text-sm font-bold mb-2">
                            Foto de Identificacion <span class="text-red-500">*</span>
                        </label>
                        <input type="file" name="foto_identificacion" accept="image/*" required
                            class="shadow border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <p class="text-xs text-gray-500 mt-1">
                            <i class="fas fa-info-circle mr-1"></i>Esta foto sera utilizada por seguridad para verificar su identidad al llegar
                        </p>
                    </div>
                </div>
            </div>

            <!-- Detalles de la visita -->
            <div class="border-b border-gray-200 pb-6 mb-6">
                <h2 class="text-lg font-semibold text-gray-700 mb-4">
                    <i class="fas fa-clipboard-list mr-2"></i>Detalles de la Visita
                </h2>

                <div class="grid grid-cols-1 gap-4">
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2">
                            Motivo de Visita <span class="text-red-500">*</span>
                        </label>
                        <textarea name="motivo" rows="3" required
                            class="shadow border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500"
                            placeholder="Indique el motivo de su visita"></textarea>
                    </div>

                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2">
                            Departamento a Visitar <span class="text-red-500">*</span>
                        </label>
                        <select name="departamento_destino" required
                            class="shadow border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="">Seleccione un departamento</option>
                            {% for d in departamentos %}
                                <option value="{{ d.id }}">{{ d.nombre }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
            </div>

            <!-- Programacion -->
            <div class="mb-6">
                <h2 class="text-lg font-semibold text-gray-700 mb-4">
                    <i class="fas fa-calendar-alt mr-2"></i>Programacion
                </h2>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2">
                            Fecha <span class="text-red-500">*</span>
                        </label>
                        <input type="date" name="fecha_programada" id="fecha_programada" required
                            class="shadow border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>

                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2">
                            Hora <span class="text-red-500">*</span>
                        </label>
                        <input type="time" name="hora_programada" required
                            class="shadow border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>

                    <div>
                        <label class="block text-gray-700 text-sm font-bold mb-2">Duracion Estimada</label>
                        <select name="duracion_estimada"
                            class="shadow border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="30">30 minutos</option>
                            <option value="60" selected>1 hora</option>
                            <option value="120">2 horas</option>
                            <option value="240">4 horas</option>
                            <option value="480">Todo el dia</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Boton -->
            <div class="text-center">
                <button type="submit"
                    class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <i class="fas fa-paper-plane mr-2"></i>Registrar Visita
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const fechaInput = document.getElementById('fecha_programada');

    // Set min date to today
    const today = new Date().toISOString().split('T')[0];
    fechaInput.min = today;
    fechaInput.value = today;
});
</script>
{% endblock %}
